# 贪吃蛇设计文档

## 要求

1.基本功能（50 分）

1. 游戏开始菜单（5 分）
2. 蛇的显示和移动（10 分）
3. 墙（砖块）和⻝物的显示与判定（20 分）
注意，蛇、砖块、不同的⻝物在显示上应有明显区别。
4. ⽀持游戏的暂停（5 分）、存档与读档（5 分）、重新开始（5 分）。

2.进阶功能（30 分）

1. 单机多⼈游戏（多条蛇，不同按键控制不同蛇）（10 分）
2. 具有三种特殊效果的⻝物（9 分）
3. 加⼀条命（需⾃⾏考虑⼀次死亡之后游戏如何继续进⾏）
4. 加速/减速
5. 最后⼀个效果不做具体要求，请发挥你的想象⼒。
6. 地图编辑（5 分）
    在游戏开始前、以及游戏暂停时，可以编辑地图上的砖块和各种⻝物
7. 简单的 AI 蛇（策略⾃拟，如按照最短路径去吃最近的⻝物等，⽆需实现的⾮常复杂）（6
    分）

3.程序的流畅性和鲁棒性（10 分）

4.注释、代码⻛格（10 分）

## 构想

1.首先需要一个大类（SnakeGame）用以包裹全部流程。将其声明在Game.h中，并在Game.cpp中实现。

2.考虑用户交互界面，首先是游戏开始界面，考虑用mainwindow实现，声明与实现分别在mainwindow.h和mainwindow.cpp中。

其次需要游戏进行界面，需要一个gameboard类，分别在 gameboard.h 和 gameboard.cpp 中声明和实现。

3.游戏实现中，由于在gameboard中可能进入不同的模式（单人游戏、双人游戏、AI蛇模式、地图编辑模式），考虑分别利用多个单独的类包裹，并根据功能设计相应函数，并在game大类中需要时调用。

4,考虑到需要对蛇、食物、墙体等进行处理，故全部进行封装，蛇类中包含其主要行为（移动，长度改变，进食等），食物类和墙体类从QPoint类继承，因为食物和墙体实际上就是board上的点的处理，分别对其进行封装实现。

## 代码说明

1.游戏开始界面部分（mainwindow)：利用QPushButton的特性，在主界面上设置所需按键，设定位置（geometry）和内容，并与信号槽联系，作为主界面。

2.贪吃蛇封装（Snakes）：需要处理蛇的移动（move）、转向（turnDir）、进食（eat）（不同食物对蛇造成不同影响）、判断是否死亡（isDead）以及蛇在面板上的更新（update）和暂停（pause），同时在后来代码实现的时候，考虑到由于吃下特殊食物会产生加速、减速、减长等特性，故添加speedUp, speedDown, die等函数对其状态改变进行实现。具体实现与注解见代码部分。

3.食物类封装（foods）：首先利用QPoint，将food（单个食物）封装为一类，再将全部食物封装进foods，便于实现食物在面板上的显示更新等。具体注释见代码部分。（最后一个特殊食物考虑到代码实现的简单原则，将其设置为：蛇吃了之后身体减短）

4.写代码过程中，首先考虑到面板上蛇、食物、墙体实际上都是点的具象化，所以封装了一个Point类，方便直接使用，而本来准备直接利用point来控制墙体的设置等，但是由于类较多，头文件较多，在game类中声明wall在其他类中不太方便使用，于是考虑写一个简单的wall类将墙体进行封装。另外，在游戏面板中需要有显示得分以及tip的信息，于是加了一个infowindow类，将这几项杂余类写进other.h，并在other.cpp中进行实现。

5.主要游戏流程控制与实现封装进SnakeGame类，将其余类全部包裹，并在函数部分实现游戏的菜单显示、面板控制、单人游戏、双人游戏、存档、编辑、以及处理键盘事件等。并且由于蛇的移动实际上是通过不断更新游戏面板来实现的，所以包裹进蛇的更新（便于调用），同时在写的过程中加上changeState类来控制状态的切换（主面板，游戏面板，游戏状态，暂停状态等状态切换）。以及其他一些流程中所需的函数也包裹进SnakeGame大类。具体注释见代码。

## 一些思考点

1.蛇的显示与移动，通过snake类的move函数和面板刷新来实现（snake类中的move用以检查并移动蛇，gameboard中刷新来实现蛇的移动）。

2.蛇的速度控制，在snake类中定义一个变量curInter用以记录当前刷新的时间间隔，用以反映速度，（因为蛇的显示与移动实际上是通过面板刷新实现的）在speedup和speeddown函数中对curInter进行处理，在面板类和蛇类中用curInter反映速度。

3.蛇，食物，墙实际上都是面板上的“点”的集合，所以在集合中会用到QPoint，而且用到point的一些性质。

4.考虑到美观，主面板和游戏面板都设置背景，并且游戏信息面板置于游戏界面右端（传统游戏常用艺能）。

5.各个面板以及功能之间通过SIGNAL和SLOT的特性加以联系，然后分块击破，用game大类串联。

6.游戏的存档和复现用文件流实现（借鉴了网上的思路），用resume文件存档当前（退出时）的面板基本信息，在读档时从文件读入并复现。

7.游戏中通过state记录状态，并通过函数实现状态切换。

## 备注

在开始写代码前查阅了不少github和csdn等地方的文档进行学习，也通过Qt官方文档对QPainter/QWidget/QPushButton/QKeyEvent等多个需要用到的Qt文档进行了一定的学习，而网上也有许多贪吃蛇成功案例，所以在自己的代码中有些地方有所借鉴学习，（但主体思路和代码都是自己想的写的）。

由于最开始忘记AI蛇了，而最后要复习其他科目，所以战术性放弃了AI蛇部分。

